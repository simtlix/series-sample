# Simfinity Project Generator Rules

You are an expert in generating complete Simfinity.js projects using the series-sample as a template. Your role is to create production-ready applications with proper structure, dependencies, and configuration.

## Project Generation Process

### Step 1: Project Setup
1. **Copy Base Structure**: Use series-sample as template
2. **Update Package.json**: Modify name, description, and dependencies
3. **Create Directory Structure**: Ensure all required folders exist
4. **Generate Configuration Files**: Create necessary config files

### Step 2: Type Generation
1. **Generate Types**: Create all type definitions following Simfinity patterns
2. **Create Validators**: Implement field and type validators
3. **Add Controllers**: Implement business logic controllers
4. **Generate Scalars**: Create custom validated scalars
5. **Update Index**: Configure type loading order

### Step 3: Application Configuration
1. **Main Entry Point**: Configure index.js with proper setup
2. **Database Connection**: Set up MongoDB connection
3. **GraphQL Server**: Configure GraphQL endpoint
4. **Middleware**: Add CORS, error handling, etc.

## Project Structure Template

```
project-name/
â”œâ”€â”€ .cursorrules                    # Main cursor rules
â”œâ”€â”€ .cursorrules-mermaid           # Mermaid diagram rules
â”œâ”€â”€ .cursorrules-project           # Project generation rules
â”œâ”€â”€ .env                          # Environment variables
â”œâ”€â”€ .gitignore                    # Git ignore rules
â”œâ”€â”€ package.json                  # Dependencies and scripts
â”œâ”€â”€ index.js                      # Main application entry
â”œâ”€â”€ app.yaml                      # Application configuration
â”œâ”€â”€ eslint.config.js              # ESLint configuration
â”œâ”€â”€ README.md                     # Project documentation
â”œâ”€â”€ types/                        # GraphQL type definitions
â”‚   â”œâ”€â”€ index.js                  # Central type loading
â”‚   â”œâ”€â”€ scalars.js                # Custom scalars
â”‚   â”œâ”€â”€ validators/               # Validation logic
â”‚   â”‚   â”œâ”€â”€ customErrors.js       # Custom error classes
â”‚   â”‚   â”œâ”€â”€ fieldValidators.js    # Field-level validations
â”‚   â”‚   â””â”€â”€ typeValidators.js     # Type-level validations
â”‚   â”œâ”€â”€ controllers/              # Business logic controllers
â”‚   â”‚   â””â”€â”€ [typeName]Controller.js
â”‚   â””â”€â”€ [typeName].js             # Individual type definitions
â”œâ”€â”€ dataset/                      # Sample data and utilities
â”‚   â”œâ”€â”€ dataset.js                # Sample data generation
â”‚   â”œâ”€â”€ loadDataset.js            # Data loading utilities
â”‚   â””â”€â”€ deleteDataset.js          # Data cleanup utilities
â”œâ”€â”€ data/                         # MongoDB data directory
â””â”€â”€ node_modules/                 # Dependencies
```

## Package.json Template

```json
{
  "name": "project-name",
  "version": "1.0.0",
  "description": "Project description - created with simfinity.js",
  "type": "module",
  "main": "index.js",
  "scripts": {
    "start": "node index.js",
    "dev": "node --watch index.js",
    "lint": "eslint ./",
    "load-data": "node dataset/loadDataset.js",
    "delete-data": "node dataset/deleteDataset.js"
  },
  "author": "Your Name",
  "license": "SEE LICENSE IN LICENSE",
  "repository": {
    "type": "git",
    "url": "https://github.com/yourusername/project-name"
  },
  "dependencies": {
    "@envelop/core": "^5.3.0",
    "@simtlix/simfinity-js": "^1.9.1",
    "cors": "^2.8.5",
    "dotenv": "^17.1.0",
    "express": "^5.1.0",
    "graphql": "^16.11.0",
    "graphql-date-scalars": "^0.2.0",
    "graphql-http": "^1.22.4",
    "mongoose": "^8.16.2",
    "node-fetch": "^3.3.2",
    "ruru": "^2.0.0-beta.24"
  },
  "devDependencies": {
    "eslint": "^9.30.1"
  }
}
```

## Main Application Template (index.js)

```javascript
import express from 'express';
import { createHandler } from 'graphql-http/lib/use/express';
import cors from 'cors';
import dotenv from 'dotenv';
import { createYoga } from 'graphql-yoga';
import { ruruHTML } from 'ruru/server';
import * as simfinity from '@simtlix/simfinity-js';

// Load environment variables
dotenv.config();

// Import types (this loads all type definitions)
import './types/index.js';

const app = express();
const PORT = process.env.PORT || 4000;

// Middleware
app.use(cors());
app.use(express.json());

// GraphQL endpoint
app.use('/graphql', createHandler({
  schema: simfinity.getSchema(),
  context: (req) => ({
    // Add any context needed
  })
}));

// GraphQL Playground
app.use('/playground', (req, res) => {
  res.type('text/html');
  res.end(ruruHTML({ endpoint: '/graphql' }));
});

// Health check endpoint
app.get('/health', (req, res) => {
  res.json({ status: 'OK', timestamp: new Date().toISOString() });
});

// Start server
app.listen(PORT, () => {
  console.log(`ðŸš€ Server running on http://localhost:${PORT}`);
  console.log(`ðŸ“Š GraphQL Playground: http://localhost:${PORT}/playground`);
  console.log(`ðŸ” GraphQL endpoint: http://localhost:${PORT}/graphql`);
});
```

## Environment Configuration (.env)

```env
# Database Configuration
MONGODB_URI=mongodb://localhost:27017/project-name
MONGODB_DB_NAME=project-name

# Server Configuration
PORT=4000
NODE_ENV=development

# Application Configuration
APP_NAME=Project Name
APP_VERSION=1.0.0
```

## Type Index Template (types/index.js)

```javascript
// Types index - centralized type loading
// Load types in dependency order to avoid circular dependency issues

// Load custom scalars first
import './scalars.js';

// Independent types first (no dependencies)
// Add your independent types here

// Types that depend on the above
// Add dependent types here

// Main types that reference others
// Add main types here

// Re-export types if needed
// Add exports here
```

## Scalars Template (types/scalars.js)

```javascript
import * as graphql from 'graphql';
import * as simfinity from '@simtlix/simfinity-js';
import { ValidationError } from './validators/customErrors.js';

const { GraphQLString, GraphQLInt, GraphQLFloat } = graphql;

// Add your custom scalars here
// Example:
// export const CustomScalar = simfinity.createValidatedScalar(
//   'CustomScalar',
//   'Description of the scalar validation',
//   GraphQLString,
//   (value) => {
//     // Validation logic
//     return value;
//   }
// );
```

## Validators Template

### Custom Errors (types/validators/customErrors.js)
```javascript
import { SimfinityError } from '@simtlix/simfinity-js';

// Validation Errors
class ValidationError extends SimfinityError {
  constructor(message) {
    super(message, 'VALIDATION_ERROR', 400);
  }
}

// Business Logic Errors
class BusinessError extends SimfinityError {
  constructor(message) {
    super(message, 'BUSINESS_ERROR', 400);
  }
}

// Authorization Errors
class AuthorizationError extends SimfinityError {
  constructor(message) {
    super(message, 'UNAUTHORIZED', 401);
  }
}

// Not Found Errors
class NotFoundError extends SimfinityError {
  constructor(message) {
    super(message, 'NOT_FOUND', 404);
  }
}

// Conflict Errors
class ConflictError extends SimfinityError {
  constructor(message) {
    super(message, 'CONFLICT', 409);
  }
}

export {
  ValidationError,
  BusinessError,
  AuthorizationError,
  NotFoundError,
  ConflictError
};
```

### Field Validators (types/validators/fieldValidators.js)
```javascript
import { ValidationError } from './customErrors.js';

// Name validators
const validateName = async (typeName, fieldName, value, session) => {
  if (!value || value.trim().length === 0) {
    throw new ValidationError(`${fieldName} cannot be empty`);
  }
  if (value.trim().length < 2) {
    throw new ValidationError(`${fieldName} must be at least 2 characters long`);
  }
  if (value.trim().length > 100) {
    throw new ValidationError(`${fieldName} cannot exceed 100 characters`);
  }
};

// Email validators
const validateEmail = async (typeName, fieldName, value, session) => {
  if (value && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
    throw new ValidationError(`${fieldName} must be a valid email address`);
  }
};

// Number validators
const validatePositiveNumber = async (typeName, fieldName, value, session) => {
  if (value !== undefined && value !== null) {
    if (typeof value !== 'number' || value <= 0) {
      throw new ValidationError(`${fieldName} must be a positive number`);
    }
  }
};

// Add more validators as needed

export {
  validateName,
  validateEmail,
  validatePositiveNumber
  // Add more exports
};
```

### Type Validators (types/validators/typeValidators.js)
```javascript
import { BusinessError } from './customErrors.js';

// Add your type-level business rule validators here
// Example:
// const validateTypeBusinessRules = async (typeName, args, modelArgs, session) => {
//   // Business logic validation
// };

export {
  // Add your exports here
};
```

## Dataset Utilities

### Dataset Generator (dataset/dataset.js)
```javascript
// Sample data generation utilities
export const generateSampleData = () => {
  return {
    // Add your sample data here
  };
};
```

### Data Loader (dataset/loadDataset.js)
```javascript
import * as simfinity from '@simtlix/simfinity-js';
import { generateSampleData } from './dataset.js';

const loadSampleData = async () => {
  try {
    const sampleData = generateSampleData();
    
    // Load data into database
    // Add your data loading logic here
    
    console.log('Sample data loaded successfully');
  } catch (error) {
    console.error('Error loading sample data:', error);
  }
};

loadSampleData();
```

### Data Cleaner (dataset/deleteDataset.js)
```javascript
import * as simfinity from '@simtlix/simfinity-js';

const deleteAllData = async () => {
  try {
    // Delete all data from collections
    // Add your data deletion logic here
    
    console.log('All data deleted successfully');
  } catch (error) {
    console.error('Error deleting data:', error);
  }
};

deleteAllData();
```

## ESLint Configuration (eslint.config.js)

```javascript
export default [
  {
    languageOptions: {
      ecmaVersion: 2022,
      sourceType: 'module',
      globals: {
        console: 'readonly',
        process: 'readonly',
        Buffer: 'readonly',
        __dirname: 'readonly',
        __filename: 'readonly',
        global: 'readonly',
        module: 'readonly',
        require: 'readonly',
        exports: 'readonly'
      }
    },
    rules: {
      'no-unused-vars': 'warn',
      'no-console': 'off',
      'prefer-const': 'error',
      'no-var': 'error'
    }
  }
];
```

## Application Configuration (app.yaml)

```yaml
name: project-name
version: 1.0.0
description: Project description
author: Your Name
license: MIT
repository: https://github.com/yourusername/project-name
dependencies:
  - @simtlix/simfinity-js
  - graphql
  - express
  - mongoose
```

## README Template

```markdown
# Project Name

Project description created with Simfinity.js

## Features

- GraphQL API with Simfinity.js
- MongoDB database
- Type validation and business rules
- State machines for complex workflows
- Custom scalars and validators

## Setup

1. Install dependencies:
   ```bash
   npm install
   ```

2. Set up environment variables:
   ```bash
   cp .env.example .env
   # Edit .env with your configuration
   ```

3. Start MongoDB:
   ```bash
   # Make sure MongoDB is running on localhost:27017
   ```

4. Load sample data (optional):
   ```bash
   npm run load-data
   ```

5. Start the server:
   ```bash
   npm start
   ```

## API Endpoints

- GraphQL: http://localhost:4000/graphql
- Playground: http://localhost:4000/playground
- Health Check: http://localhost:4000/health

## Development

- Run with watch mode: `npm run dev`
- Lint code: `npm run lint`
- Delete all data: `npm run delete-data`

## License

MIT
```

## Generation Commands

### Generate Complete Project
```
Generate a complete Simfinity.js project for [description] using series-sample as template
```

### Generate Types from Mermaid
```
Generate Simfinity.js types from this Mermaid diagram: [diagram]
```

### Generate Single Type
```
Generate a [typeName] type with fields [fieldList] and relations [relationList]
```

### Generate Validators
```
Generate validators for [typeName] with business rules [rules]
```

### Generate Controller
```
Generate controller for [typeName] with business logic [logic]
```

## Best Practices

1. **Always use series-sample as template**: Ensure compatibility
2. **Follow naming conventions**: camelCase for fields, PascalCase for types
3. **Include proper validations**: Field and type-level validations
4. **Add business logic**: Controllers for complex operations
5. **Document everything**: Clear comments and README
6. **Test thoroughly**: Include sample data and test scenarios
7. **Handle errors gracefully**: Proper error handling and messages
8. **Follow Simfinity patterns**: Use exact patterns from series-sample

Remember: Always generate production-ready code that follows Simfinity.js patterns exactly as shown in the series-sample project.
